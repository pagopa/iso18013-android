package it.pagopa.io.wallet.proximity

import it.pagopa.io.wallet.cbor.model.DocType
import it.pagopa.io.wallet.cbor.model.Document
import it.pagopa.io.wallet.cbor.model.IssuerSigned
import it.pagopa.io.wallet.cbor.parser.CBorParser
import it.pagopa.io.wallet.proximity.request.DocRequested
import it.pagopa.io.wallet.proximity.response.ResponseGenerator
import it.pagopa.io.wallet.proximity.response.ResponseGenerator.Response
import org.json.JSONObject
import org.junit.Test
import kotlin.io.encoding.Base64
import kotlin.io.encoding.ExperimentalEncodingApi

class ResponseGeneratorTest {
    private val mockNew by lazy {
        "omdkb2NUeXBldW9yZy5pc28uMTgwMTMuNS4xLm1ETGxpc3N1ZXJTaWduZWSiam5hbWVTcGFjZXOhcW9yZy5pc28uMTgwMTMuNS4xjNgYWGCkZnJhbmRvbVggLvwhxcMnAySfU7qGQNnmhHEOxxee7c8XjrRx2VF8bb1oZGlnZXN0SUQAbGVsZW1lbnRWYWx1ZfVxZWxlbWVudElkZW50aWZpZXJrYWdlX292ZXJfMTjYGFhspGZyYW5kb21YIHp+f7PuEJbCOg2iOfJHxKy/9HPywVMDWF1p8MGSifgPaGRpZ2VzdElEAWxlbGVtZW50VmFsdWXZA+xqMjAwMS0wOS0xMXFlbGVtZW50SWRlbnRpZmllcmpiaXJ0aF9kYXRl2BhYbKRmcmFuZG9tWCA1Mz00tPtVTIndtp8wyLtnQ2iY+oMFPoLvWHUK1RdrMmhkaWdlc3RJRAJsZWxlbWVudFZhbHVlaDExMDkyMDAxcWVsZW1lbnRJZGVudGlmaWVyb2RvY3VtZW50X251bWJlctgYWQEApGZyYW5kb21YILTbqN0lRmjJgl8um4nFqUqk6x4QB/+L0jL8NdLQqE9JaGRpZ2VzdElEA2xlbGVtZW50VmFsdWWCo2ppc3N1ZV9kYXRl2QPsajIwMjAtMDMtMzFrZXhwaXJ5X2RhdGXZA+xqMjAyNS0xMS0wNXV2ZWhpY2xlX2NhdGVnb3J5X2NvZGViQU2jamlzc3VlX2RhdGXZA+xqMjAyNC0wMy0xNGtleHBpcnlfZGF0ZdkD7GoyMDI1LTA0LTEwdXZlaGljbGVfY2F0ZWdvcnlfY29kZWFCcWVsZW1lbnRJZGVudGlmaWVycmRyaXZpbmdfcHJpdmlsZWdlc9gYWGakZnJhbmRvbVggBrJcuopt5vMMNlVilgbFztbh9rAKz7df3SPxFMX5aStoZGlnZXN0SUQEbGVsZW1lbnRWYWx1ZWJGQ3FlbGVtZW50SWRlbnRpZmllcm9pc3N1aW5nX2NvdW50cnnYGFhspGZyYW5kb21YIEPbWC+4Ca91qS1rY7JZrPXcJ8Me/mjMBNECsEJ4HcR4aGRpZ2VzdElEBWxlbGVtZW50VmFsdWXZA+xqMjAyNC0wOS0yNnFlbGVtZW50SWRlbnRpZmllcmppc3N1ZV9kYXRl2BhYbaRmcmFuZG9tWCCQ1LvyrTYj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SE/YLcKCD4KlERERUv8Ab8qR4UoiIi0besAT/pczdv8A6ft/+VywgRERERERERERERERERFkF0Kbnt2m6p9Bamq68UlBUXFtrrpSwvAgqmmEjiO+fmAz7eV9EDMeGuOCBj8fUELmREREVL/b8qR4UoiIi0besAR/pcz+f/gFv/yuWECIiIiIiIiIiIiIiIiIuSnnnp5o56eZ8UsTg+N7HFrmuB7EEeCPqvpd6fNbU24uymiNb0tQ6Vl4sVJUF7hhxcY2h+e5+bkDkexJHsrjoiIiKl/t+VI8KURERaNvV/8A9rmb/cFD/lcsIERERERERERERERERERS3yt43pBatOoekdljfE9h0xqS4Wscz2c14jqwQP3R/wClHt9QSs4URERFS/2/KkeFKIiItG/rAf7XE3+4Lf8A5XLB9EREREREREREREREREUt8ra56I2pbu+3bqaPkqy61001rucFO5o4x1ErZ45XNI8l7IYgQfHwxj95bS0RERFS/wBvypHhSiIiLRt6wP8Atcz/AO4Lf/lcsIERERERERERERERERERFnr6P+5dZo/qRr9BTOlFHrWzTQFpIDG1FMfixyHIySGiZgwcD4hJBwt17Hl2Sexb7LkRERFS/wBvypHhSiIiLRr6vzg7q7qG/Sw2/wDyuWEKIiIiIiIiIiIiIiIiIivn0WsrH9V21kdDK5lQdSUgif27Hlj7/ugjB8ecr6MYuOMg5JXIiIiKl/t+VI8KURERaPPWAs90o+rJ1yrKb4dJcNP0MlI/OfitZljj9sODv6LBpEREREREREREREREREUs7nus7PR/0db9RdU1XfK0P+PprTNXcKZjQCHufJDTkkEfuiY4wQeWM5GVu2jAGcBcqIiIqX+35UjwpRERFqP9aPb7UrtYaI3WdC+SwutxsImAbiOpEks7Wu7/ALzXOI9vkJ+gWsh3lQiIiIiIiIiIiIiIiIiePC2ieiDSRS3/AHZrJG/rIqO0RNz44vdUk/z+Qf1W2PAHgBSiIiKl/t+VI8KURERWL6zNoX759NeudvKWNz7jVW8VttDSGn9LpntnhZyPYB74+DneQyRxHcBfOpU00tLNLS1EL4pYnFj2PbhzXNJBBHsRggj6hdZERERERERERERERERFLO57rc/6RPT7rLanbbUe5etKCe3P18+hNto5QGyspIGyubM8cst+IZsN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"
    }
    private val mockSessionsTranscript = ByteArray(10)
    private val mockFieldRequestedAndAccepted by lazy {
        JSONObject(
            """{"request":{"org.iso.18013.5.1.mDL":{"org.iso.18013.5.1":{"height":true,"weight":true,"portrait":true,"birth_date":true,"eye_colour":true,"given_name":true,"issue_date":true,"age_over_18":true,"age_over_21":true,"birth_place":true,"expiry_date":true,"family_name":true,"hair_colour":true,"nationality":true,"age_in_years":true,"resident_city":true,"age_birth_year":true,"resident_state":true,"document_number":true,"issuing_country":true,"resident_address":true,"resident_country":true,"issuing_authority":true,"driving_privileges":true,"issuing_jurisdiction":true,"resident_postal_code":true,"signature_usual_mark":true,"administrative_number":true,"portrait_capture_date":true,"un_distinguishing_sign":true,"given_name_national_character":true,"family_name_national_character":true}},"eu.europa.ec.eudi.pid.1":{"eu.europa.ec.eudi.pid.1":{"gender":true,"portrait":true,"birth_city":true,"birth_date":true,"given_name":true,"age_over_13":true,"age_over_16":true,"age_over_18":true,"age_over_21":true,"age_over_60":true,"age_over_65":true,"age_over_68":true,"birth_place":true,"birth_state":true,"expiry_date":true,"family_name":true,"nationality":true,"age_in_years":true,"birth_country":true,"issuance_date":true,"resident_city":true,"age_birth_year":true,"resident_state":true,"document_number":true,"issuing_country":true,"resident_street":true,"given_name_birth":true,"resident_address":true,"resident_country":true,"family_name_birth":true,"issuing_authority":true,"issuing_jurisdiction":true,"resident_postal_code":true,"administrative_number":true,"portrait_capture_date":true,"resident_house_number":true}},"org.iso.18013.5.1.reservation":{"org.iso.18013.5.reservation.1":{"guests":true,"location":true,"birth_date":true,"car_rental":true,"given_name":true,"expiry_date":true,"family_name":true,"num_of_rooms":true,"check_in_date":true,"issuance_date":true,"check_out_date":true,"reservation_id":true,"issuing_country":true,"reservation_date":true,"issuing_authority":true,"booking_service_name":true,"service_provider_name":true}},"org.iso.23220.2.photoid.1":{"org.iso.23220.photoid.1":{"gender":true,"portrait":true,"person_id":true,"birth_city":true,"birth_date":true,"given_name":true,"age_over_18":true,"birth_place":true,"birth_state":true,"expiry_date":true,"family_name":true,"nationality":true,"age_in_years":true,"birth_country":true,"issuance_date":true,"resident_city":true,"age_birth_year":true,"resident_state":true,"document_number":true,"issuing_country":true,"resident_street":true,"given_name_birth":true,"resident_address":true,"resident_country":true,"family_name_birth":true,"issuing_authority":true,"issuing_jurisdiction":true,"resident_postal_code":true,"administrative_number":true,"portrait_capture_date":true,"resident_house_number":true,"travel_document_number":true}}}}}"""
        )
    }

    @Test
    fun createOpenIdV4SessionTranscript() {
        val sessionTranscript = OpenID4VP(
            "clientId",
            "responseUri",
            "authorizationRequestNonce",
            "mdocGeneratedNonce"
        ).createSessionTranscript()
        val parser = CBorParser(sessionTranscript).toJson()
        println(parser)
    }

    @OptIn(ExperimentalEncodingApi::class)
    @Test
    fun createResponseTest() {
        ResponseGenerator(mockSessionsTranscript)
            .createResponse(
                arrayOf(DocRequested(mockNew, "alias", DocType.MDL.value)),
                mockFieldRequestedAndAccepted.toString(),
                object : Response {
                    override fun onResponseGenerated(response: ByteArray) {
                        println(Base64.encode(response))
                    }

                    override fun onError(message: String) {
                        println("ERROR: $message")
                    }
                })
    }

    @OptIn(ExperimentalEncodingApi::class)
    @Test
    fun `create data elements test`() {
        val disclosedDocument = Document.fromByteArray(Base64.decode(mockNew))
        val docToJson = disclosedDocument.toJson(true)
        println(docToJson)
        val doc = DocRequested(
            Base64.encode(disclosedDocument.issuerSigned!!.rawValue!!),
            "alias",
            disclosedDocument.docType!!
        )
        val bytes = Base64.decode(doc.issuerSignedContent)
        val issuerSigned = IssuerSigned.issuerSignedFromByteArray(bytes)
        val dataElements = ResponseGenerator(mockSessionsTranscript)
            .createDataElements(
                issuerSigned!!,
                mockFieldRequestedAndAccepted.getJSONObject("request")
            )
        val jsonNameSpaces = docToJson
            .getJSONObject("issuerSigned")
            .getJSONObject("nameSpaces")
        println("NAME_SPACES:")
        println(jsonNameSpaces)
        val array = jsonNameSpaces.get("org.iso.18013.5.1") as ArrayList<*>
        array.forEach {
            val elIdentifier = (it as JSONObject).getString("elementIdentifier")
            assert(dataElements.any {
                it.dataElementName == elIdentifier
            })
        }
    }
}